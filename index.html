<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skalní Hřiby | Expertí Geomorfologie</title>
    <link rel="stylesheet" href="premium-design.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>

<body>

    <div class="progress-bar"></div>

    <div class="liquid-container">
        <nav class="liquid-nav">
            <div class="nav-liquid-bg">
                <div class="nav-blob"></div>
                <div class="nav-indicator"></div>
            </div>
            <a href="#hero" class="active" data-index="0">Domů</a>
            <a href="#litologie" data-index="1">Litologie</a>
            <a href="#procesy" data-index="2">Procesy</a>
            <a href="#future" data-index="3">Osud</a>
            <a href="#lokality" data-index="4">Atlas</a>
        </nav>
    </div>




    <section id="hero" class="hero">
        <div class="hero-bg" id="heroBg"></div>
        <div class="hero-content">
            <span class="reveal"
                style="text-transform: uppercase; letter-spacing: 4px; font-weight: 700; color: var(--primary);"></span>
            <h1 id="heroTitle" style="opacity: 0; transform: translateY(50px);">SKALNÍ<br>HŘIBY</h1>
            <p id="heroLead" style="opacity: 0; transform: translateY(30px);">Komplexní pohled do světa selektivního
                zvětrávání a geomorfologických procesů pískovcových měst.</p>
            <div class="reveal" style="margin-top: 40px;">
                <a href="#genesis" class="btn-premium" id="startJourneyBtn">ZAČÍT</a>
            </div>
        </div>
    </section>

    <section id="genesis" class="reveal">
        <h2 style="text-align: center; margin-bottom: 60px;">Jak hřib vzniká?</h2>
        <div class="grid" style="grid-template-columns: repeat(3, 1fr); gap: 30px;">
            <div class="glass-card" style="text-align: center;">
                <div style="font-size: 2.5rem; color: var(--primary); margin-bottom: 20px;"><i data-lucide="waves"></i>
                </div>
                <h4 data-inspectable="true" data-topic="Sedimentace pískovce u skalních hřibů">1. Usazování</h4>
                <div class="more-info-static" style="padding-top: 15px; font-size: 0.85rem; color: var(--text-dim);"
                    data-inspectable="true" data-topic="Mořská sedimentace v druhohorách">
                    Před miliony lety se na dně moře vrstvil písek.</div>
                <button class="btn-anim" onclick="openAnimation('sediment')">Sledovat proces</button>
            </div>
            <div class="glass-card" style="text-align: center;">
                <div style="font-size: 2.5rem; color: var(--primary); margin-bottom: 20px;"><i data-lucide="lock"></i>
                </div>
                <h4 data-inspectable="true" data-topic="Diageneze a litifikace pískovce">2. Ztvrdnutí</h4>
                <div class="more-info-static" style="padding-top: 15px; font-size: 0.85rem; color: var(--text-dim);"
                    data-inspectable="true" data-topic="Tmel v pískovci a jeho vliv na tvrdost">
                    Tlakem a chemií se písek slepil v kámen.</div>
                <button class="btn-anim" onclick="openAnimation('lithos')">Sledovat proces</button>
            </div>
            <div class="glass-card" style="text-align: center;">
                <div style="font-size: 2.5rem; color: var(--primary); margin-bottom: 20px;"><i
                        data-lucide="mountain"></i></div>
                <h4 data-inspectable="true" data-topic="Erozní modelování geomorfologických útvarů">3. Obroušení</h4>
                <div class="more-info-static" style="padding-top: 15px; font-size: 0.85rem; color: var(--text-dim);"
                    data-inspectable="true" data-topic="Eolická eroze a koraze">
                    Vítr a mráz začaly vybrousit tvary.</div>
                <p style="font-size: 0.8rem; color: var(--primary); margin-top: 15px;">Vyzkoušejte v simulátoru níže ↓
                </p>
            </div>
        </div>

        <div class="glass-card" style="margin-top: 40px;" id="simulace">
            <h3 style="text-align: center; margin-bottom: 30px;">Simulátor Selektivní Eroze</h3>
            <div style="display: flex; gap: 40px; align-items: center;">
                <div style="flex: 1;">
                    <p style="font-size: 0.95rem;">Zde můžete v reálném čase sledovat, jak pískem nasycený vítr (koraze)
                        modeluje spodní část skály.</p>
                    <div style="margin-top: 30px; display: flex; gap: 15px;">
                        <button id="startBtn" class="btn-premium"
                            style="margin-top: 0; cursor: pointer; background: var(--primary); color: #000;">Spustit
                            Erozi</button>
                        <button id="resetBtn" class="btn-premium"
                            style="margin-top: 0; cursor: pointer;">Resetovat</button>
                    </div>
                </div>
                <div id="canvas-container"
                    style="flex: 1.5; height: 350px; background: rgba(0,0,0,0.3); border-radius: 20px; position: relative; overflow: hidden; display: flex; justify-content: center; align-items: bottom;">
                    <div id="rock-model"
                        style="width: 120px; height: 180px; background: #554433; align-self: flex-end; border-radius: 10px 10px 0 0; transition: width 5s linear, height 5s linear; position: relative; margin-bottom: 20px;">
                        <div id="cap-rock"
                            style="width: 130px; height: 50px; background: #3d3126; border-radius: 50% 50% 10px 10px; position: absolute; top: -10px; left: 50%; transform: translateX(-50%); border-bottom: 3px solid #2a221a;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="litologie" class="expert-grid" style="direction: rtl;">
        <div style="direction: ltr;" class="reveal">
            <h2 style="margin-bottom: 30px; letter-spacing: 1px;">OD ROVINY K VĚŽÍM</h2>
            <div class="glass-card" style="padding: 40px; border-right: 4px solid var(--primary);">
                <p style="font-size: 1.1rem; line-height: 1.7; color: var(--text-main);">
                    Sedimenty (písek) se původně usazovaly ve vodorovných vrstvách na mořském dně. Jak se z nich ale
                    staly samostatné sloupy?
                </p>
                <div style="margin-top: 25px; display: grid; gap: 20px;">
                    <div style="display: flex; gap: 20px;">
                        <span style="font-size: 2rem; color: var(--primary); font-weight: 800; opacity: 0.5;">01</span>
                        <p style="color: var(--text-dim);"><strong>Tektonika a praskání:</strong> Při výzdvihu zemské
                            kůry vznikly v masivu svislé trhliny (tzv. pukliny). Pískovec se tak rozdělil na obří
                            kvádry.</p>
                    </div>
                    <div style="display: flex; gap: 20px;">
                        <span style="font-size: 2rem; color: var(--primary); font-weight: 800; opacity: 0.5;">02</span>
                        <p style="color: var(--text-dim);"><strong>Rozšiřování spár:</strong> Do těchto prasklin vnikla
                            voda, mráz a kořeny rostlin. Ty mechanicky rozšiřovaly mezery mezi bloky.</p>
                    </div>
                    <div style="display: flex; gap: 20px;">
                        <span style="font-size: 2rem; color: var(--primary); font-weight: 800; opacity: 0.5;">03</span>
                        <p style="color: var(--text-dim);"><strong>Izolace sloupu:</strong> Postupem času se okolní masa
                            horniny rozpadla, čímž zůstaly stát osamocené skalní věže a budoucí "hřiby".</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="reveal">
            <img src="assets/hero.png" id="imgLitologie" alt="Vertikální pukliny" class="parallax-img"
                style="border-radius: 30px; border: 1px solid var(--glass-border); max-height: 500px; width: 100%; object-fit: cover;">
        </div>
    </section>

    <section id="procesy" class="expert-grid">
        <div class="reveal">
            <h2 style="margin-bottom: 30px; letter-spacing: 2px;" data-inspectable="true"
                data-topic="Mechanismus selektivní eroze">PRINCIP SELEKTIVNÍ EROZE</h2>
            <div class="glass-card" style="padding: 40px; border-left: 4px solid var(--primary);">
                <p style="font-size: 1.2rem; margin-bottom: 25px; color: #fff; font-weight: 600;"
                    data-inspectable="true" data-topic="Diferenciální zvětrávání hornin">
                    Klíčem ke vzniku hřibu je různorodá odolnost horninových vrstev.
                </p>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: var(--primary); margin-bottom: 10px; display: flex; align-items: center; gap: 10px;"
                        data-inspectable="true" data-topic="Křemitý a železitý tmel u pokliček">
                        <i data-lucide="chevron-up"></i> Horní část (Klobouk)
                    </h4>
                    <p style="color: var(--text-dim); line-height: 1.6;">
                        Je obvykle tvořena pískovcem s <strong>křemitým nebo železitým tmelem</strong>, který je velmi
                        tvrdý a odolný vůči zvětrávání.
                    </p>
                </div>

                <div>
                    <h4
                        style="color: var(--accent); margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                        <i data-lucide="chevron-down"></i> Spodní část (Noha)
                    </h4>
                    <p style="color: var(--text-dim); line-height: 1.6;">
                        Je z měkčího, <strong>hlinitého pískovce</strong>, který podléhá erozi mnohem rychleji působením
                        vlhkosti a pískem nasyceného větru u země.
                    </p>
                </div>
            </div>
        </div>
        <div class="reveal" style="display: flex; align-items: center; justify-content: center;">
            <img src="assets/forest.png" id="imgProcesy" alt="Geologický detail" class="parallax-img"
                style="border-radius: 30px; border: 1px solid var(--glass-border); max-height: 500px; width: 100%; object-fit: cover;">
        </div>
    </section>



    <section id="future" class="reveal" style="margin-top: 100px; margin-bottom: 100px;">
        <div class="glass-card"
            style="padding: 60px; text-align: center; background: linear-gradient(135deg, rgba(20,20,20,0.4), rgba(5,5,5,0.6)); border: 1px solid rgba(255,78,95,0.2);">
            <h2 style="margin-bottom: 30px; letter-spacing: 2px; color: var(--accent);">OSUD SKALNÍCH HŘIBŮ</h2>
            <div style="max-width: 800px; margin: 0 auto;">
                <p style="font-size: 1.25rem; line-height: 1.8; color: var(--text-main); margin-bottom: 30px;">
                    Skalní hřiby jsou z geologického hlediska jen <strong>pomíjivým okamžikem</strong>. Proces, který je
                    vytvořil, je nakonec i zahubí.
                </p>
                <div class="grid"
                    style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; text-align: left;">
                    <div style="background: rgba(255,255,255,0.03); padding: 25px; border-radius: 20px;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">Kdy se zřítí?</h4>
                        <p style="color: var(--text-dim); font-size: 0.95rem;">Nedá se to určit přesně na rok. Některé
                            útvary stojí staletí, jiné mohou zaniknout během jedné extrémní bouře nebo mrazivé zimy, kdy
                            led roztrhne oslabenou nohu.</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.03); padding: 25px; border-radius: 20px;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">Bod zlomu</h4>
                        <p style="color: var(--text-dim); font-size: 0.95rem;">Jakmile noha hřibu dosáhne kritického
                            zúžení, přestane zvládat váhu masivního klobouku. Gravitace pak vykoná své a klobouk se
                            vlastní vahou odlomí a zřítí.</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.03); padding: 25px; border-radius: 20px;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">Status: Ohrožené</h4>
                        <p style="color: var(--text-dim); font-size: 0.95rem;">Mnohé slavné hřiby jsou dnes přísně
                            chráněny a monitorovány. Jsou to unikátní sochy přírody, které už nikdo znovu nepostaví –
                            jakmile jednou padnou, proces začíná od nuly.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="lokality" style="text-align: center;">
        <h2 class="reveal">Světový a Lokální Atlas</h2>
        <div class="expert-grid" style="margin-top: 60px; text-align: left;">
            <div class="glass-card reveal">
                <h4>Česká Republika</h4>
                <p>Broumovské stěny (hřiby u Slavného), Kokořínsko, České Švýcarsko.</p>
            </div>
            <div class="glass-card reveal">
                <h4>Světové Lokality</h4>
                <p>Bardenas Reales (Španělsko), Goblin Valley (USA), Wadi Rum (Jordánsko).</p>
            </div>
        </div>
        <div id="map"
            style="height: 600px; margin-top: 60px; border-radius: 40px; border: 1px solid var(--glass-border); z-index: 1;"
            class="reveal"></div>
    </section>

    </section>

    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="position: absolute; width: 0; height: 0;">
        <defs>
            <filter id="goo">
                <feGaussianBlur in="SourceGraphic" stdDeviation="8" result="blur" />
                <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 20 -9"
                    result="goo" />
            </filter>
        </defs>
    </svg>

    <div class="modal-overlay" id="animationModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Animace procesu</h2>
            <p id="modalDesc" style="color: var(--text-dim); margin-top: 10px;"></p>
            <div id="animation-view">
                <canvas id="genCanvas"></canvas>
            </div>
        </div>
    </div>

    <!-- Location Detail Modal -->
    <div class="modal-overlay" id="locationModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeLocModal()">&times;</span>
            <div class="loc-detail-grid">
                <div class="loc-anim-item" style="opacity: 0; transform: translateX(-30px);">
                    <img id="locImg" src=""
                        style="width: 100%; border-radius: 30px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 20px 40px rgba(0,0,0,0.4);">
                </div>
                <div class="loc-info-content">
                    <h2 id="locTitle" class="loc-anim-item"
                        style="margin-bottom: 20px; opacity: 0; transform: translateY(20px);"></h2>
                    <p id="locDesc" class="loc-anim-item"
                        style="color: var(--text-dim); margin-bottom: 30px; line-height: 1.8; opacity: 0; transform: translateY(20px);">
                    </p>
                    <div class="loc-anim-item"
                        style="display: flex; gap: 15px; flex-wrap: wrap; opacity: 0; transform: translateY(20px);">
                        <span id="locAge" class="glass-tag"></span>
                        <span id="locType" class="glass-tag"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- QR Code Modal -->
    <div class="modal-overlay" id="qrModal">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <span class="modal-close" onclick="closeQrModal()">&times;</span>
            <h2 style="margin-bottom: 20px;">Mobilní průvodce</h2>
            <p style="color: var(--text-dim); margin-bottom: 25px;">Naskenujte pro stažení materiálů do mobilu.</p>
            <div style="background: white; padding: 20px; border-radius: 20px; display: inline-block;">
                <img id="qrImg" src="assets/qr.png"
                    style="width: 250px; height: 250px; display: block; border-radius: 10px; filter: contrast(1.1);">
            </div>
            <p style="margin-top: 20px; font-size: 0.8rem; color: var(--primary);">QR Kód - Geologická Expertíza</p>
        </div>
    </div>

    <footer style="padding: 120px 10%; text-align: center; color: var(--text-dim); position: relative;">
        <div class="footer-tools-left">
            <div class="zoom-container footer-tool-btn">
                <i data-lucide="maximize-2" style="width: 14px; height: 14px;"></i>
                <input type="range" min="1" max="2" step="0.1" value="1" class="zoom-slider" id="zoomSlider">
                <span class="zoom-label" id="zoomLabel">100%</span>
            </div>
        </div>

        <p>&copy; 2026 Vytvořeno pro skupinu: Votoček, Pavelka, Fišer a Kopecký na Zeměpis</p>

        <div class="footer-tools-right">
            <button class="footer-tool-btn" onclick="openQrModal()">
                <i data-lucide="qr-code" style="width: 14px; height: 14px;"></i>QR Guide
            </button>
        </div>
    </footer>

    <script>
        const heroImg = 'assets/hero.png';
        const forestImg = 'assets/forest.png';
        document.getElementById('heroBg').style.backgroundImage = `url('${heroImg}')`;
        document.getElementById('imgProcesy').src = forestImg;
        document.getElementById('imgLitologie').src = heroImg;

        lucide.createIcons();
        gsap.registerPlugin(ScrollTrigger);

        gsap.to("#heroTitle", { opacity: 1, y: 0, duration: 1.5, ease: "power4.out", delay: 0.5 });
        gsap.to("#heroLead", { opacity: 1, y: 0, duration: 1.5, ease: "power4.out", delay: 0.8 });
        gsap.to(".hero-bg", { scale: 1, duration: 2, ease: "power2.out" });

        const navLinks = document.querySelectorAll('.liquid-nav a');
        const blob = document.querySelector('.nav-blob');
        const indicator = document.querySelector('.nav-indicator');

        function moveIndicator(el) {
            if (!el) return;
            const rect = el.getBoundingClientRect();
            const navRect = el.parentElement.getBoundingClientRect();
            const left = rect.left - navRect.left;
            gsap.to(blob, { left: left, width: rect.width, duration: 0.8, ease: "elastic.out(1, 0.7)" });
            gsap.to(indicator, { left: left, width: rect.width, duration: 0.6, ease: "power4.out" });
        }

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href');
                const targetEl = document.querySelector(targetId);
                navLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                moveIndicator(link);
                window.scrollTo({ top: targetEl.offsetTop - 100, behavior: 'smooth' });
            });
        });

        document.getElementById('startJourneyBtn').addEventListener('click', (e) => {
            e.preventDefault();
            window.scrollTo({ top: document.querySelector('#genesis').offsetTop - 100, behavior: 'smooth' });
        });

        const sectionsForNav = ['hero', 'genesis', 'procesy', 'diagenese', 'litologie', 'future', 'simulace', 'lokality'];
        sectionsForNav.forEach(id => {
            const el = document.getElementById(id);
            if (!el) return;
            ScrollTrigger.create({
                trigger: el, start: "top center", end: "bottom center",
                onEnter: () => updateNav(id), onEnterBack: () => updateNav(id)
            });
        });

        function updateNav(id) {
            let mapping = {
                'hero': '#hero',
                'genesis': '#litologie',
                'procesy': '#procesy',
                'litologie': '#litologie',
                'future': '#future',
                'lokality': '#lokality'
            };
            const targetHref = mapping[id];
            const activeLink = document.querySelector(`.liquid-nav a[href="${targetHref}"]`);
            if (activeLink) {
                navLinks.forEach(l => l.classList.remove('active'));
                activeLink.classList.add('active');
                moveIndicator(activeLink);
            }
        }

        window.addEventListener('load', () => moveIndicator(document.querySelector('.liquid-nav a.active')));

        const reveals = document.querySelectorAll('.reveal');
        reveals.forEach(el => {
            ScrollTrigger.create({ trigger: el, start: "top 85%", onEnter: () => el.classList.add('active') });
        });

        gsap.to(".progress-bar", {
            width: "100%",
            scrollTrigger: { scrub: 0.5, start: "top top", end: "bottom bottom" }
        });

        gsap.to(".parallax-img", {
            y: -50, scrollTrigger: { trigger: ".parallax-img", scrub: true }
        });

        // Erosion Sim
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const rockModel = document.getElementById('rock-model');
        const canvasContainer = document.getElementById('canvas-container');
        let sandInterval;

        function createSandParticle() {
            const p = document.createElement('div');
            p.className = 'sand-particle';
            const y = 170 + (Math.random() * 150); // Focused on the neck area
            p.style.setProperty('--y', `${y}px`);
            const size = 4 + Math.random() * 5;
            p.style.width = p.style.height = `${size}px`;
            p.style.animation = `fly-sand ${0.5 + Math.random()}s linear forwards`;
            canvasContainer.appendChild(p);
            setTimeout(() => p.remove(), 1500);
        }

        startBtn.addEventListener('click', () => {
            rockModel.style.width = '30px'; rockModel.style.height = '160px';
            clearInterval(sandInterval);
            sandInterval = setInterval(createSandParticle, 20);
            startBtn.disabled = true; startBtn.style.opacity = '0.5';
            setTimeout(() => { clearInterval(sandInterval); }, 5000);
        });

        resetBtn.addEventListener('click', () => {
            clearInterval(sandInterval);
            rockModel.style.width = '120px'; rockModel.style.height = '180px';
            startBtn.disabled = false; startBtn.style.opacity = '1';
            document.querySelectorAll('.sand-particle').forEach(p => p.remove());
        });

        function toggleInfo(el) {
            const info = el.querySelector('.more-info');
            if (info.style.display === 'none') { gsap.fromTo(info, { height: 0, opacity: 0, display: 'block' }, { height: 'auto', opacity: 1, duration: 0.5, ease: 'power2.out' }); }
            else { gsap.to(info, { height: 0, opacity: 0, duration: 0.3, ease: 'power2.in', onComplete: () => info.style.display = 'none' }); }
        }

        // Map
        const map = L.map('map', { scrollWheelZoom: false }).setView([40, 0], 2);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
        const locations = [
            { name: "Slavenské hřiby (CZ)", coords: [50.536, 16.291], desc: "Broumovsko.", img: "assets/slavenskehriby.jpg", info: "Unikátní pískovcové útvary v CHKO Broumovsko. Vznikly selektivním větráním kvádrových pískovců svrchní křídy.", age: "Svrchní křída", type: "Pískovec" },
            { name: "Kokořínské pokličky (CZ)", coords: [50.448, 14.582], desc: "Kokořínsko.", img: "assets/kokorin.jpg", info: "Vrchní vrstva je tvořena pevným železitým pískovcem (slepencem), který chrání měkčí nohu před erozí.", age: "Křída", type: "Železitý pískovec" },
            { name: "White Pocket (USA)", coords: [36.958, -111.903], desc: "Arizona.", img: "assets/whitepocket.jpg", info: "Fascinující oblast v poušti Arizona známá svými pokroucenými tvary a 'mozkem' připomínající strukturou skal.", age: "Jura", type: "Pískovec Navajo" },
            { name: "Goblin Valley (USA)", coords: [38.565, -110.702], desc: "Utah.", img: "assets/goblinvalley.jpg", info: "Tisíce malých hřibovitých útvarů (hoodoos), které vznikaly erozí střídajících se vrstev pískovce a břidlice.", age: "Jura", type: "Pískovec Entrada" },
            { name: "Bardenas Reales (ESP)", coords: [42.188, -1.488], desc: "Španělsko.", img: "assets/spain.jpg", info: "Polopouštní oblast v Navarře s výraznými hřiby, stolovými horami a kaňony modelovanými prudkými dešti a větrem.", age: "Třetihorní sedimenty", type: "Jílovec / Pískovec" },
            { name: "Wadi Rum (JOR)", coords: [29.576, 35.421], desc: "Jordánsko.", img: "assets/wadirum.jpg", info: "Údolí vryté do pískovcových a žulových skal. Místní hřiby jsou modelovány extrémními teplotními rozdíly a pískem.", age: "Prvohory až křída", type: "Pískovec / Žula" }
        ];
        locations.forEach((loc, index) => {
            const m = L.circleMarker(loc.coords, { radius: 8, fillColor: "var(--primary)", color: "#fff", weight: 2, opacity: 1, fillOpacity: 0.8 }).addTo(map);
            m.bindPopup(`
                <div style="color: #ffffff; width: 160px; text-align: center;">
                    <img src="${loc.img}" style="width: 100%; border-radius: 8px; margin-bottom: 8px;">
                    <strong style="display: block; margin-bottom: 5px;">${loc.name}</strong>
                    <button class="btn-anim" style="color: #ffffff; border-color: var(--primary); width: 100%;" onclick="showLocationDetails(${index}, this)">Zobrazit Detail</button>
                </div>
            `);
        });

        // Location Detail Logic
        function showLocationDetails(index, btnEl) {
            const loc = locations[index];
            const modal = document.getElementById('locationModal');
            const modalContent = modal.querySelector('.modal-content');

            // Set content first
            document.getElementById('locTitle').innerText = loc.name;
            document.getElementById('locDesc').innerText = loc.info;
            document.getElementById('locImg').src = loc.img;
            document.getElementById('locAge').innerText = "Věk: " + loc.age;
            document.getElementById('locType').innerText = "Hornina: " + loc.type;

            // Find the image in the popup for the starting position
            const popupImg = btnEl.parentElement.querySelector('img');
            const startRect = popupImg.getBoundingClientRect();

            modal.style.display = 'flex';
            const modalRect = modalContent.getBoundingClientRect();

            // Reset items
            gsap.set(".loc-anim-item", { opacity: 0 });

            // Animation sequence
            const tl = gsap.timeline();

            // 1. Overlay fade in
            tl.to(modal, { opacity: 1, duration: 0.3 });

            // 2. Content Zoom-from-preview
            tl.fromTo(modalContent,
                {
                    x: startRect.left + startRect.width / 2 - window.innerWidth / 2,
                    y: startRect.top + startRect.height / 2 - window.innerHeight / 2,
                    scale: startRect.width / modalRect.width,
                    opacity: 0,
                    borderRadius: "20px"
                },
                {
                    x: 0,
                    y: 0,
                    scale: 1,
                    opacity: 1,
                    borderRadius: "40px",
                    duration: 0.8,
                    ease: "expo.out"
                }, "-=0.2");

            // 3. Stagger items
            tl.to(".loc-anim-item", {
                opacity: 1,
                y: 0,
                x: 0,
                duration: 0.6,
                stagger: 0.1,
                ease: "power2.out"
            }, "-=0.4");
        }

        function closeLocModal() {
            const modal = document.getElementById('locationModal');
            const tl = gsap.timeline({
                onComplete: () => {
                    modal.style.display = 'none';
                }
            });
            tl.to(".loc-anim-item", { opacity: 0, y: 20, duration: 0.3, stagger: 0.05 })
                .to(modal, { opacity: 0, duration: 0.3 });
        }

        function openQrModal() {
            const modal = document.getElementById('qrModal');
            modal.style.display = 'flex';
            gsap.to(modal, { opacity: 1, duration: 0.5 });
        }

        function closeQrModal() {
            const modal = document.getElementById('qrModal');
            gsap.to(modal, { opacity: 0, duration: 0.3, onComplete: () => modal.style.display = 'none' });
        }

        // GENESIS ANIMATIONS
        const genCanvas = document.getElementById('genCanvas');
        const gctx = genCanvas.getContext('2d');
        let currentAnim;

        function openAnimation(type) {
            const modal = document.getElementById('animationModal');
            modal.style.display = 'flex';
            gsap.to(modal, { opacity: 1, duration: 0.5 });
            genCanvas.width = genCanvas.offsetWidth; genCanvas.height = genCanvas.offsetHeight;
            if (type === 'sediment') {
                document.getElementById('modalTitle').innerText = '1. Usazování';
                document.getElementById('modalDesc').innerText = 'Písek se snáší k mořskému dnu.';
                startSedimentAnimation();
            } else if (type === 'lithos') {
                document.getElementById('modalTitle').innerText = '2. Ztvrdnutí';
                document.getElementById('modalDesc').innerText = 'Tlak mění písek v kámen.';
                startLithoAnimation();
            } else {
                document.getElementById('modalTitle').innerText = '3. Obroušení';
                document.getElementById('modalDesc').innerText = 'Vítr vybrousí nohu hřibu.';
                startErosionGenAnimation();
            }
        }

        function closeModal() {
            const modal = document.getElementById('animationModal');
            gsap.to(modal, { opacity: 0, duration: 0.3, onComplete: () => { modal.style.display = 'none'; cancelAnimationFrame(currentAnim); } });
        }

        function startSedimentAnimation() {
            let pts = [], layers = 0;
            const cw = genCanvas.width;
            const ch = genCanvas.height;
            function loop() {
                gctx.fillStyle = '#000'; gctx.fillRect(0, 0, cw, ch);
                // Particle source centered
                if (pts.length < 60) pts.push({
                    x: (cw / 2 - 120) + Math.random() * 240,
                    y: 0,
                    vx: (Math.random() - 0.5) * 0.5
                });
                pts.forEach((p, i) => {
                    p.y += 2.5;
                    p.x += p.vx;
                    gctx.fillStyle = '#d4b483'; gctx.fillRect(p.x, p.y, 3, 3);
                    // Collision with bottom layer
                    if (p.y > ch - 20 - layers * 0.15) { pts.splice(i, 1); layers++; }
                });
                // Centered sediment layer
                gctx.fillStyle = '#8b7355';
                const layerH = 20 + layers * 0.15;
                gctx.fillRect(cw / 2 - 150, ch - layerH, 300, layerH);
                currentAnim = requestAnimationFrame(loop);
            }
            loop();
        }

        function startLithoAnimation() {
            let f = 0;
            function loop() {
                f++; gctx.fillStyle = '#000'; gctx.fillRect(0, 0, genCanvas.width, genCanvas.height);
                gctx.fillStyle = `rgba(139, 115, 85, ${0.4 + Math.sin(f * 0.05) * 0.2})`;
                gctx.fillRect(genCanvas.width / 2 - 80, 100, 160, 160);
                gctx.fillStyle = 'var(--primary)';
                for (let i = 0; i < 30; i++) gctx.fillRect(genCanvas.width / 2 - 70 + (i % 6) * 25, 110 + Math.floor(i / 6) * 30 + Math.sin(f * 0.1 + i) * 5, 4, 4);
                currentAnim = requestAnimationFrame(loop);
            }
            loop();
        }

        function startErosionGenAnimation() {
            let f = 0;
            let particles = [];
            for (let i = 0; i < 40; i++) particles.push({ x: Math.random() * genCanvas.width, y: 190 + Math.random() * 80, s: 3 + Math.random() * 4 });

            function loop() {
                f++;
                gctx.fillStyle = '#000';
                gctx.fillRect(0, 0, genCanvas.width, genCanvas.height);

                // Flying Sand
                gctx.fillStyle = '#d4b483';
                particles.forEach(p => {
                    p.x += 8 + Math.random() * 4;
                    if (p.x > genCanvas.width) p.x = -10;
                    gctx.fillRect(p.x, p.y + Math.sin(f * 0.2 + p.x * 0.05) * 5, p.s, p.s);
                });

                const cx = genCanvas.width / 2;
                // Head (Top block)
                gctx.fillStyle = '#3d3126';
                gctx.fillRect(cx - 90, 110, 180, 70);

                // Neck (Bottom block) - narrowing
                gctx.fillStyle = '#8b7355';
                let w = 100 - Math.min(f * 0.15, 75);
                gctx.fillRect(cx - w / 2, 180, w, 110);

                // Ground
                gctx.fillStyle = '#1a1a1a';
                gctx.fillRect(0, 290, genCanvas.width, 110);

                if (w > 26) {
                    currentAnim = requestAnimationFrame(loop);
                } else {
                    setTimeout(() => {
                        if (document.getElementById('animationModal').style.display !== 'none') {
                            f = 0;
                            currentAnim = requestAnimationFrame(loop);
                        }
                    }, 2000);
                }
            }
            loop();
        }
        // PRESENTATION ZOOM LOGIC
        const zoomSlider = document.getElementById('zoomSlider');
        const zoomLabel = document.getElementById('zoomLabel');

        zoomSlider.addEventListener('input', (e) => {
            const zoom = e.target.value;
            document.documentElement.style.setProperty('--text-zoom', zoom);
            zoomLabel.innerText = Math.round(zoom * 100) + '%';
        });

        // Existing close functions...
    </script>
</body>

</html>